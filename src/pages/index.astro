---
import BaseLayout from '../components/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import MarketSection from '../components/MarketSection.astro';
---

<BaseLayout title="Jakar Industries — Technology for Those Who Serve" description="Jakar Industries develops technology for military and first responders. Immerse yourself in our mission across defense, public safety, and innovation.">
  <Hero
    isFullScreen={true}
    title="Defining the Future of Mission Solutions"
    subtitle="We pioneer innovative technologies that empower military and first responders — delivering precision, reliability, and capability in the most demanding environments."
    ctaText="Discover Our Mission"
    ctaHref="#defense"
    backgroundVideo="/videos/hero-jet.mp4"
    marketLinks={[
      { label: "Defense Ops", href: "#defense" },
      { label: "First Responders", href: "#first-responders" },
      { label: "Systems Support", href: "#systems-support" },
      { label: "Innovation", href: "#innovation" }
    ]}
  />


  <MarketSection
    id="defense"
    title="Defense Operations"
    description="Providing elite military forces with the tactical advantage through advanced sensor integration, secure communications, and mission-proven hardware."
    videoSrc="/videos/hero-jet.mp4"
  />

  <MarketSection
    id="first-responders"
    title="First Responders"
    description="Empowering law enforcement and emergency services with real-time situational awareness and robust network solutions for critical safety missions."
    videoSrc="/videos/hero-about.mp4"
  />

  <MarketSection
    id="systems-support"
    title="Systems Support"
    description="End-to-end mission sustainment, including lifecycle management, specialized training, and 24/7 technical logistics for global operations."
    videoSrc="/videos/hero-capabilities.mp4"
  />

  <MarketSection
    id="innovation"
    title="Innovation & AI"
    description="Pioneering the next frontier of defense technology through autonomous systems, artificial intelligence, and next-generation data analytics."
    videoSrc="/videos/hero-contact.mp4"
  />

  <section id="contact" class="cta-strip">
    <div class="section">
      <span class="section-tag">Direct Mission Support</span>
      <h2>Partner with Jakar Industries</h2>
      <p>Interested in learning more or partnering with us on a critical project? Our mission experts are ready to assist.</p>
      <a href="mailto:info@jakarindustries.com" class="btn btn--outline">Connect with an Expert</a>
    </div>
  </section>
</BaseLayout>

<script>
  // Orchestrate the morphing scroll experience
  const sections = document.querySelectorAll('.market-section');
  const marketLinks = document.querySelectorAll('.market-btn');

  // Handle high-impact smooth scrolls
  marketLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      const targetId = link.getAttribute('href');
      if (targetId?.startsWith('#')) {
        e.preventDefault();
        const targetElement = document.querySelector(targetId);
        if (targetElement) {
          // Add a temporary state for immediate reveal feel
          targetElement.classList.add('market-section--preparing');
          
          targetElement.scrollIntoView({ behavior: 'smooth' });
          
          // Force reveal slightly early
          setTimeout(() => {
            targetElement.classList.add('market-section--visible');
            targetElement.classList.remove('market-section--preparing');
          }, 100);
        }
      }
    });
  });

  // Intersection Observer for natural scroll reveals
  const observerOptions = {
    threshold: 0, // Trigger immediately on any intersection
    rootMargin: '0px 0px 0px 0px' 
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      const video = entry.target.querySelector('video[data-market-video]');

      if (entry.isIntersecting) {
        entry.target.classList.add('market-section--visible');
        if (video) video.play().catch(() => {});
      } else {
        // Simple reset: if it's not intersecting, hide it
        entry.target.classList.remove('market-section--visible');
        if (video) video.pause();
      }
    });
  }, observerOptions);

  sections.forEach(section => observer.observe(section));

  // Handle header transparency on scroll
  const header = document.querySelector('.header');
  window.addEventListener('scroll', () => {
    if (window.scrollY > 50) {
      header?.classList.add('header--scrolled');
    } else {
      header?.classList.remove('header--scrolled');
    }
  }, { passive: true });
</script>

<style>

  .cta-strip {
    background-color: #000;
    color: var(--color-white);
    text-align: center;
    padding: var(--space-4xl) var(--space-lg);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
  }

  .cta-strip h2 {
    font-size: clamp(2rem, 4.5vw, 3rem);
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    font-weight: 900;
  }

  .cta-strip p {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 3rem;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
  }
</style>
